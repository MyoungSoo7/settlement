# BIBE-VIEW (Frontend View Structure & Flow)

## 📋 프론트엔드 개요
**Lemuel Frontend** - React + TypeScript + Vite 기반 정산 시스템 UI
단일 페이지 애플리케이션(SPA)으로 구현된 전자상거래 정산 관리 인터페이스

---

## 🎨 화면 구조

### 전체 화면 목록

```
/                      → /order (자동 리다이렉트)
├── /login             → 로그인 화면
├── /register          → 회원가입 화면
├── /order             → 주문 & 결제 화면 (USER 권한)
├── /dashboard         → 정산 대시보드 (USER 권한)
└── /admin             → 정산 관리 (ADMIN 권한)
```

---

## 🔐 인증 및 권한

### 인증 상태
- **비로그인**: `/login`, `/register`만 접근 가능
- **로그인(USER)**: `/order`, `/dashboard` 접근 가능
- **로그인(ADMIN)**: 모든 화면 접근 가능, `/admin` 추가 접근

### 권한 체크 컴포넌트
- **ProtectedRoute**: 로그인 필수 (USER 이상)
- **AdminRoute**: 관리자 전용 (ADMIN만)

---

## 📱 화면별 상세 구조

### 1. Login (로그인 화면)
**경로**: `/login`
**권한**: 비로그인만
**파일**: `frontend/src/pages/Login.tsx`

#### 화면 구성
```
┌─────────────────────────────┐
│         Lemuel              │
│   정산 시스템 로그인          │
├─────────────────────────────┤
│  이메일: [____________]     │
│  비밀번호: [____________]   │
│                             │
│  ⚠️ 에러 메시지 (선택적)    │
│                             │
│  [ 로그인 ]                 │
│                             │
│  계정이 없으신가요? 회원가입  │
└─────────────────────────────┘
```

#### 기능
- 이메일/비밀번호 입력
- JWT 토큰 발급 및 localStorage 저장
- 로그인 성공 시 `/dashboard`로 이동
- 회원가입 링크 클릭 시 `/register`로 이동

#### API 연동
- `POST /auth/login` → JWT 토큰 수신

---

### 2. Register (회원가입 화면)
**경로**: `/register`
**권한**: 비로그인만
**파일**: `frontend/src/pages/Register.tsx`

#### 화면 구성
```
┌─────────────────────────────┐
│         Lemuel              │
│        Sign Up              │
├─────────────────────────────┤
│  이메일: [____________]     │
│  비밀번호: [____________]   │
│  비밀번호 확인: [_______]   │
│                             │
│  ⚠️ 에러 메시지 (선택적)    │
│                             │
│  [ 회원가입 ]               │
│                             │
│  이미 계정이 있으신가요? 로그인│
└─────────────────────────────┘
```

#### 기능
- 이메일/비밀번호/비밀번호 확인 입력
- 비밀번호 일치 검증
- 이메일 중복 체크 (409 Conflict)
- 회원가입 성공 시 `/login`으로 이동

#### API 연동
- `POST /users` → 사용자 생성

---

### 3. OrderPage (주문 & 결제 화면)
**경로**: `/order`
**권한**: USER 이상
**파일**: `frontend/src/pages/OrderPage.tsx`

#### 화면 구성 (4단계 플로우)

##### Step 1: 주문 정보 입력
```
┌─────────────────────────────┐
│     주문 & 결제              │
│ 상품 주문 및 결제를 진행합니다│
├─────────────────────────────┤
│  주문 금액(원): [_______]   │
│  결제 수단: [신용카드 ▼]    │
│                             │
│  [ 주문하기 ]               │
└─────────────────────────────┘
```

##### Step 2: 주문 생성 완료
```
┌─────────────────────────────┐
│   주문이 생성되었습니다       │
├─────────────────────────────┤
│  주문 번호: #123            │
│  주문 금액: ₩50,000        │
│  주문 상태: CREATED         │
│                             │
│  [ 결제 진행하기 ]          │
└─────────────────────────────┘
```

##### Step 3: 결제 준비
```
┌─────────────────────────────┐
│       결제 정보              │
├─────────────────────────────┤
│  결제 번호: #456            │
│  결제 금액: ₩50,000        │
│  결제 수단: CARD            │
│  결제 상태: READY           │
│                             │
│  [ 결제하기 ]               │
└─────────────────────────────┘
```

##### Step 4: 결제 완료
```
┌─────────────────────────────┐
│      ✅ 결제가 완료되었습니다!│
│   정상적으로 결제가 처리되었습니다│
├─────────────────────────────┤
│  주문 번호: #123            │
│  결제 번호: #456            │
│  PG 거래 ID: pg_12345678    │
│  ────────────────────────   │
│  결제 금액: ₩50,000        │
│                             │
│  [ 새로운 주문하기 ]         │
└─────────────────────────────┘
```

#### 기능
1. 주문 생성 → Order (status: CREATED)
2. 결제 생성 → Payment (status: READY)
3. 결제 승인 → Payment (status: AUTHORIZED)
4. 결제 확정 → Payment (status: CAPTURED), Order (status: PAID)

#### API 연동
- `POST /orders` → 주문 생성
- `POST /payments` → 결제 생성
- `POST /payments/{id}/authorize` → 결제 승인
- `POST /payments/{id}/capture` → 결제 확정

---

### 4. SettlementDashboard (정산 대시보드)
**경로**: `/dashboard`
**권한**: USER 이상
**파일**: `frontend/src/pages/SettlementDashboard.tsx`

#### 화면 구성
```
┌──────────────────────────────────────────────────────┐
│              정산 대시보드                            │
├──────────────────────────────────────────────────────┤
│  [검색 필터]                                         │
│  주문자명: [____] 상품명: [____] 상태: [전체▼]      │
│  시작일: [____]   종료일: [____]  환불:[전체▼]      │
│  [ 검색 ]                                            │
├──────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐            │
│  │총 정산 금액│ │총 환불 금액│ │최종 정산 금액│          │
│  │ ₩500,000 │ │ ₩50,000  │ │ ₩450,000 │          │
│  └──────────┘ └──────────┘ └──────────┘            │
├──────────────────────────────────────────────────────┤
│  [정산 테이블]                                       │
│  ┌──┬─────┬────┬─────┬─────┬─────┬────┬────┐   │
│  │ID│주문자│상품│금액 │환불 │최종 │상태│날짜│   │
│  ├──┼─────┼────┼─────┼─────┼─────┼────┼────┤   │
│  │#1│홍길동│제품A│50K │ 0  │50K │확정│0101│   │
│  │#2│김철수│제품B│100K│10K │90K │대기│0102│   │
│  └──┴─────┴────┴─────┴─────┴─────┴────┴────┘   │
│                                                      │
│  [ ◀ ] [ 1 ] [ 2 ] [ 3 ] [ ▶ ]                     │
└──────────────────────────────────────────────────────┘
```

#### 기능
- **검색 필터**: 주문자명, 상품명, 상태, 기간, 환불 여부
- **집계 정보**: 총 정산 금액, 총 환불 금액, 최종 정산 금액
- **정산 목록**: 페이징 처리된 정산 내역 테이블
- **상태 뱃지**: 색상으로 구분된 정산 상태 표시
- **페이지네이션**: 이전/다음 버튼 및 페이지 번호

#### API 연동
- `GET /settlements/search` → 정산 검색 (필터, 페이징, 집계)

---

### 5. SettlementAdmin (정산 관리 화면)
**경로**: `/admin`
**권한**: ADMIN만
**파일**: `frontend/src/pages/SettlementAdmin.tsx`

#### 화면 구성
```
┌──────────────────────────────────────────────────────┐
│          정산 관리 대시보드                           │
│  정산 내역을 확인하고 승인/반려 처리를 할 수 있습니다   │
├──────────────────────────────────────────────────────┤
│  [검색 필터]                                         │
│  상태:[승인대기▼] 시작일:[____] 종료일:[____] [검색]│
├──────────────────────────────────────────────────────┤
│  ┌────┐ ┌────────┐ ┌────────┐ ┌────────┐          │
│  │총건수│ │총정산금액│ │환불금액 │ │최종금액 │          │
│  │ 150 │ │₩5,000K │ │₩500K  │ │₩4,500K│          │
│  └────┘ └────────┘ └────────┘ └────────┘          │
├──────────────────────────────────────────────────────┤
│  [정산 목록 테이블]                                  │
│  ┌──┬─────┬────┬─────┬────┬────┬──────────┐     │
│  │ID│주문자│상품│최종 │상태│날짜│  작업     │     │
│  ├──┼─────┼────┼─────┼────┼────┼──────────┤     │
│  │#1│홍길동│제품A│50K │대기│0101│상세|승인|반려│     │
│  │#2│김철수│제품B│90K │승인│0102│상세       │     │
│  └──┴─────┴────┴─────┴────┴────┴──────────┘     │
│                                                      │
│  [ ◀ ] [ 1 ] [ 2 ] [ 3 ] [ ▶ ]                     │
└──────────────────────────────────────────────────────┘
```

#### 모달: 정산 상세 정보
```
┌─────────────────────────────┐
│  정산 상세 정보        [X]  │
├─────────────────────────────┤
│  정산 ID: #123              │
│  주문 ID: #456              │
│  결제 ID: #789              │
│  정산 금액: ₩50,000        │
│  정산 상태: 승인대기         │
│  정산일: 2026-01-01         │
└─────────────────────────────┘
```

#### 모달: 승인 확인
```
┌─────────────────────────────┐
│  정산 승인                   │
├─────────────────────────────┤
│  정산 ID #123를 승인하시겠습니까?│
│  ₩50,000                    │
│                             │
│  [ 승인 ] [ 취소 ]          │
└─────────────────────────────┘
```

#### 모달: 반려
```
┌─────────────────────────────┐
│  정산 반려                   │
├─────────────────────────────┤
│  정산 ID #123를 반려합니다.  │
│                             │
│  반려 사유 (필수)            │
│  [____________________]     │
│  [____________________]     │
│                             │
│  [ 반려 ] [ 취소 ]          │
└─────────────────────────────┘
```

#### 기능
- **검색 필터**: 정산 상태, 기간
- **집계 정보**: 총 건수, 총 정산 금액, 환불 금액, 최종 금액
- **정산 목록**: 승인 대기 중인 정산 우선 표시
- **상세 보기**: 정산 상세 정보 모달
- **승인 처리**: 정산 승인 → status: APPROVED
- **반려 처리**: 정산 반려 (사유 필수) → status: REJECTED

#### API 연동
- `GET /settlements/search` → 정산 목록 조회
- `GET /settlements/{id}` → 정산 상세 조회
- `POST /settlements/{id}/approve` → 정산 승인
- `POST /settlements/{id}/reject` → 정산 반려 (body: 반려 사유)

---

## 🔄 화면 흐름도 (User Flow)

### 전체 플로우
```
[접속]
  ↓
[로그인 여부?]
  ├─ No → /login → 로그인 성공 → /dashboard
  │              ↓
  │         [회원가입 링크]
  │              ↓
  │         /register → 회원가입 완료 → /login
  │
  └─ Yes → /order (기본 리다이렉트)
```

### 주문 & 결제 플로우 (OrderPage)
```
/order 진입
  ↓
[Step 1] 주문 정보 입력
  - 금액 입력
  - 결제 수단 선택
  ↓ [주문하기 클릭]
  ↓ POST /orders
  ↓
[Step 2] 주문 생성 완료
  - 주문 번호 표시
  - 주문 상태: CREATED
  ↓ [결제 진행하기 클릭]
  ↓ POST /payments
  ↓
[Step 3] 결제 준비
  - 결제 번호 표시
  - 결제 상태: READY
  ↓ [결제하기 클릭]
  ↓ POST /payments/{id}/authorize (승인)
  ↓ POST /payments/{id}/capture (확정)
  ↓
[Step 4] 결제 완료
  - 완료 메시지
  - PG 거래 ID 표시
  - 결제 상태: CAPTURED
  - 주문 상태: PAID
  ↓ [새로운 주문하기 클릭]
  ↓
[Step 1]로 돌아감
```

### 정산 대시보드 플로우 (SettlementDashboard)
```
/dashboard 진입
  ↓
자동 정산 목록 조회
GET /settlements/search
  ↓
┌────────────────────────┐
│  [검색 필터 입력]       │
│    - 주문자명          │
│    - 상품명            │
│    - 상태              │
│    - 기간              │
│    - 환불 여부         │
└────────────────────────┘
  ↓ [검색 버튼 클릭]
  ↓
재조회 (필터 적용)
  ↓
┌────────────────────────┐
│  [집계 정보 표시]       │
│  [정산 테이블 표시]     │
│  [페이지네이션]        │
└────────────────────────┘
  ↓ [페이지 번호 클릭]
  ↓
해당 페이지 데이터 조회
```

### 정산 관리 플로우 (SettlementAdmin)
```
/admin 진입 (ADMIN만)
  ↓
자동 정산 목록 조회
  ↓
[필터로 승인 대기 중인 정산 검색]
  ↓
┌─────────────────────────┐
│  정산 목록 표시         │
│  (승인대기 상태 우선)   │
└─────────────────────────┘
  ↓
[작업 선택]
  ├─ [상세보기 클릭]
  │   ↓ GET /settlements/{id}
  │   ↓ 상세 정보 모달 표시
  │   ↓ [X] 버튼 → 모달 닫기
  │
  ├─ [승인 클릭]
  │   ↓ 정산 상세 조회
  │   ↓ 승인 확인 모달 표시
  │   ↓ [승인 버튼]
  │   ↓ POST /settlements/{id}/approve
  │   ↓ 성공 → 목록 새로고침
  │   ↓ Settlement.status = APPROVED
  │
  └─ [반려 클릭]
      ↓ 정산 상세 조회
      ↓ 반려 모달 표시
      ↓ 반려 사유 입력 (필수)
      ↓ [반려 버튼]
      ↓ POST /settlements/{id}/reject
      ↓ 성공 → 목록 새로고침
      ↓ Settlement.status = REJECTED
```

---

## 🎨 공통 컴포넌트

### Layout
**파일**: `frontend/src/components/Layout.tsx`

네비게이션 바와 콘텐츠 영역을 포함하는 레이아웃 컴포넌트

```
┌────────────────────────────────────────┐
│  Lemuel  |  주문  |  대시보드  |  로그아웃│  ← 네비게이션 바
├────────────────────────────────────────┤
│                                        │
│         {children}                     │  ← 페이지 콘텐츠
│                                        │
└────────────────────────────────────────┘
```

**기능**:
- 현재 사용자 정보 표시
- 페이지 링크 (주문, 대시보드, 관리자)
- 로그아웃 버튼
- ADMIN 권한이 있을 경우 관리자 메뉴 표시

---

### Card
**파일**: `frontend/src/components/Card.tsx`

재사용 가능한 카드 컴포넌트

```
┌─────────────────────┐
│  타이틀 (선택)       │
├─────────────────────┤
│                     │
│  {children}         │
│                     │
└─────────────────────┘
```

---

### Spinner
**파일**: `frontend/src/components/Spinner.tsx`

로딩 상태 표시 컴포넌트

```
    ⟳ (회전 애니메이션)
  로딩 메시지...
```

**Props**:
- `size`: 'sm' | 'md' | 'lg'
- `message`: 로딩 메시지

---

## 🔌 API 연동 구조

### API 파일 구조
```
frontend/src/api/
├── axios.ts           # Axios 인스턴스 (JWT 인터셉터 포함)
├── auth.ts            # 인증 API (로그인, 회원가입)
├── order.ts           # 주문 API
├── payment.ts         # 결제 API
├── refund.ts          # 환불 API
└── settlement.ts      # 정산 API (검색, 승인, 반려)
```

### Axios 인터셉터
**파일**: `frontend/src/api/axios.ts`

- **요청 인터셉터**: localStorage에서 JWT 토큰 자동 추가
- **응답 인터셉터**: 401 에러 시 자동 로그아웃 및 로그인 페이지로 리다이렉트

---

## 🎨 디자인 시스템

### 색상 체계
- **Primary (Blue)**: 주요 액션 버튼, 링크
- **Success (Green)**: 완료 상태, 승인, 최종 금액
- **Warning (Yellow)**: 대기 상태, 주의 필요
- **Danger (Red)**: 에러, 반려, 환불
- **Gray**: 기본 텍스트, 테두리

### 상태별 색상
```
정산 상태:
- CALCULATED      → 노란색 (Yellow)
- WAITING_APPROVAL→ 파란색 (Blue)
- APPROVED        → 초록색 (Green)
- REJECTED        → 빨간색 (Red)
- PENDING         → 회색 (Gray)
- CONFIRMED       → 남색 (Indigo)
- CANCELED        → 빨간색 (Red)

주문 상태:
- CREATED         → 노란색 (Yellow)
- PAID            → 초록색 (Green)
- CANCELED        → 빨간색 (Red)
- REFUNDED        → 빨간색 (Red)

결제 상태:
- READY           → 파란색 (Blue)
- AUTHORIZED      → 남색 (Indigo)
- CAPTURED        → 초록색 (Green)
- FAILED          → 빨간색 (Red)
```

### 타이포그래피
- **Title (h1)**: 4xl, font-bold (페이지 제목)
- **Subtitle (h2)**: 2xl, font-bold (섹션 제목)
- **Body**: text-sm ~ text-base (본문)
- **Label**: text-sm, font-medium (폼 레이블)

---

## 📊 데이터 흐름

### 상태 관리
React의 `useState`와 `useEffect`를 사용한 로컬 상태 관리

```
컴포넌트 마운트
  ↓
useEffect 실행
  ↓
API 호출 (Loading true)
  ↓
데이터 수신
  ↓
setState (데이터 저장)
  ↓
리렌더링 (Loading false)
```

### 에러 처리
```
API 호출
  ↓
try-catch
  ├─ 성공 → 데이터 저장
  └─ 실패 → 에러 메시지 설정
          ↓
      에러 배너 표시
```

---

## 🔄 실시간 업데이트 전략

### 수동 새로고침
- 필터 변경 시 자동 재조회
- 승인/반려 처리 후 목록 새로고침
- 페이지 변경 시 해당 페이지 데이터 조회

### 향후 개선 가능 영역
- WebSocket을 통한 실시간 정산 알림
- Server-Sent Events(SSE)로 정산 상태 변경 푸시
- Polling을 통한 주기적 업데이트

---

## 📱 반응형 디자인

### 브레이크포인트
- **Mobile**: < 640px (sm)
- **Tablet**: 640px ~ 1024px (md)
- **Desktop**: > 1024px (lg)

### 적응형 레이아웃
- **필터**: 모바일에서 세로 스택, 데스크톱에서 그리드
- **테이블**: 모바일에서 가로 스크롤
- **페이지네이션**: 모바일에서 간소화 (이전/다음만)

---

## 🔐 보안 고려사항

### JWT 토큰 관리
- localStorage에 저장 (access_token, user_email, user_role)
- 모든 API 요청 시 Authorization 헤더에 자동 포함
- 401 에러 시 자동 로그아웃

### 권한 체크
- 라우터 레벨에서 권한 검증 (ProtectedRoute, AdminRoute)
- ADMIN 전용 화면 접근 시 role 체크
- 권한 없을 경우 자동 리다이렉트

---

## 🎯 사용자 시나리오

### 일반 사용자 (USER)
1. 로그인
2. 주문 & 결제 진행 (/order)
3. 정산 내역 확인 (/dashboard)

### 관리자 (ADMIN)
1. 로그인
2. 정산 관리 화면 접속 (/admin)
3. 승인 대기 중인 정산 검토
4. 승인 또는 반려 처리
5. 정산 대시보드에서 전체 현황 확인

---

## 📈 성능 최적화

### 최적화 전략
- **Code Splitting**: 라우트별 동적 임포트
- **Lazy Loading**: 이미지 및 컴포넌트 지연 로딩
- **Debouncing**: 검색 필터 입력 시 디바운싱
- **Pagination**: 대용량 데이터 페이징 처리
- **Caching**: Axios 응답 캐싱 (선택적)

---

## 🚀 빌드 및 배포

### 빌드
```bash
cd frontend
npm run build
```

### 환경 변수
```
VITE_API_BASE_URL=http://lemuel.local/api
```

### Nginx 설정
- `/` → 프론트엔드 (정적 파일)
- `/api/*` → 백엔드 (프록시)

---

## 🔄 화면 간 데이터 전달

### 네비게이션
- `useNavigate()` 훅 사용
- 로그인 성공 → `/dashboard`
- 회원가입 성공 → `/login`
- 권한 없음 → `/login`

### 전역 상태
- localStorage를 통한 사용자 정보 공유
- authApi.getCurrentUser()로 현재 사용자 조회

---

**작성일**: 2026-02-12
**버전**: 1.0.0
**기술 스택**: React 18, TypeScript, Vite, TailwindCSS, React Router v6
