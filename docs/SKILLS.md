# ê¸°ìˆ  ìŠ¤íƒ & ê¸°ëŠ¥

## ðŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend
- **Java**: 21
- **Spring Boot**: 3.5.10
- **Spring Security**: JWT ê¸°ë°˜ ì¸ì¦
- **Spring Data JPA**: ORM ë ˆì´ì–´
- **Spring Batch**: ì •ì‚° ë°°ì¹˜ ìž‘ì—…
- **Flyway**: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### Database
- **PostgreSQL**: 17 (ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤)
- **Elasticsearch**: 8.x (ê²€ìƒ‰ ì—”ì§„, Cloud)
  - **analysis-nori**: í•œê¸€ í˜•íƒœì†Œ ë¶„ì„ í”ŒëŸ¬ê·¸ì¸

### Monitoring & Observability
- **Prometheus**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Grafana**: ì‹œê°í™” ëŒ€ì‹œë³´ë“œ
- **Spring Boot Actuator**: ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§

### Build & Tools
- **Gradle**: ë¹Œë“œ ë„êµ¬ (Kotlin DSL)
- **Docker & Docker Compose**: ì»¨í…Œì´ë„ˆí™”
- **Swagger/OpenAPI**: API ë¬¸ì„œí™”

### Test
- **JUnit 5**: ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ í”„ë ˆìž„ì›Œí¬
- **Spring Boot Test**: í†µí•© í…ŒìŠ¤íŠ¸ ì§€ì›

## ðŸŽ¯ í•µì‹¬ ê¸°ëŠ¥

### 1. ì¸ì¦ ë° ì‚¬ìš©ìž ê´€ë¦¬
- **JWT ê¸°ë°˜ ì¸ì¦**: í† í° ê¸°ë°˜ ë¬´ìƒíƒœ(stateless) ì¸ì¦
- **Spring Security í†µí•©**: ë³´ì•ˆ í•„í„° ì²´ì¸
- **ì‚¬ìš©ìž ê¶Œí•œ ê´€ë¦¬**: ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´

### 2. ì£¼ë¬¸ ê´€ë¦¬ (Order)
- **ì£¼ë¬¸ ìƒì„±**: ê³ ê° ì£¼ë¬¸ ë°ì´í„° ìƒì„±
- **ì£¼ë¬¸ ìƒíƒœ ê´€ë¦¬**:
  - `CREATED`: ì£¼ë¬¸ ìƒì„± (ê²°ì œ ëŒ€ê¸°)
  - `PAID`: ê²°ì œ ì™„ë£Œ
  - `CANCELED`: ê²°ì œ ì „ ì·¨ì†Œ
  - `REFUNDED`: ê²°ì œ í›„ í™˜ë¶ˆ ì™„ë£Œ
- **ì£¼ë¬¸ ì´ë ¥ ì¶”ì **: ì „ì²´ ì£¼ë¬¸ ìƒì• ì£¼ê¸° ê´€ë¦¬

### 3. ê²°ì œ ì²˜ë¦¬ (Payment)
- **ë‹¤ì–‘í•œ ê²°ì œ ìˆ˜ë‹¨ ì§€ì›**: ì¹´ë“œ, ê°„íŽ¸ê²°ì œ ë“±
- **ê²°ì œ ìƒíƒœ ê´€ë¦¬**:
  - `READY`: ê²°ì œ ì¤€ë¹„
  - `AUTHORIZED`: ìŠ¹ì¸ ì™„ë£Œ
  - `CAPTURED`: ë§¤ìž… ì™„ë£Œ (ì‹¤ì œ ê²°ì œ)
  - `FAILED`: ê²°ì œ ì‹¤íŒ¨
  - `CANCELED`: ìŠ¹ì¸ ì·¨ì†Œ
  - `REFUNDED`: ì „ì•¡ í™˜ë¶ˆ
- **PG ì—°ë™**: ì™¸ë¶€ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ íŠ¸ëžœìž­ì…˜ ê´€ë¦¬
- **ê²°ì œ ê¸ˆì•¡ ì¶”ì **: `refundedAmount` í•„ë“œë¡œ í™˜ë¶ˆ ëˆ„ì  ê´€ë¦¬

### 4. í™˜ë¶ˆ ì²˜ë¦¬ (Refund) - v0.2.0
- **ë¶€ë¶„/ì „ì•¡ í™˜ë¶ˆ**: ìœ ì—°í•œ í™˜ë¶ˆ ì •ì±…
- **ë©±ë“±ì„± ë³´ìž¥**: `Idempotency-Key` í—¤ë” ê¸°ë°˜ ì¤‘ë³µ í™˜ë¶ˆ ë°©ì§€
- **ë™ì‹œì„± ì œì–´**: PESSIMISTIC_WRITE ë½ìœ¼ë¡œ í™˜ë¶ˆ ê¸ˆì•¡ ì´ˆê³¼ ë°©ì§€
- **í™˜ë¶ˆ ìƒíƒœ ê´€ë¦¬**:
  - `REQUESTED`: í™˜ë¶ˆ ìš”ì²­
  - `APPROVED`: í™˜ë¶ˆ ìŠ¹ì¸
  - `COMPLETED`: í™˜ë¶ˆ ì™„ë£Œ
  - `FAILED`: í™˜ë¶ˆ ì‹¤íŒ¨
  - `CANCELED`: í™˜ë¶ˆ ì·¨ì†Œ
- **í™˜ë¶ˆ ì´ë ¥ ë¶„ë¦¬**: Refund ì—”í‹°í‹°ë¡œ ë…ë¦½ ê´€ë¦¬ (íšŒê³„ ê°ì‚¬ ì¶”ì )

### 5. ì •ì‚° ì‹œìŠ¤í…œ (Settlement)
- **ìžë™ ì •ì‚° ë°°ì¹˜**:
  - ë§¤ì¼ ìƒˆë²½ 2ì‹œ: ì „ë‚  CAPTURED ê²°ì œ â†’ PENDING ì •ì‚° ìƒì„±
  - ë§¤ì¼ ìƒˆë²½ 3ì‹œ: PENDING â†’ CONFIRMED í™•ì •
  - ë§¤ì¼ ìƒˆë²½ 3ì‹œ 10ë¶„: ì •ì‚° ì¡°ì • í™•ì •
- **ì •ì‚° ìƒíƒœ ê´€ë¦¬**:
  - `PENDING`: ì •ì‚° ëŒ€ê¸°
  - `CONFIRMED`: ì •ì‚° í™•ì •
- **ì •ì‚° ì¡°ì • (SettlementAdjustment)**:
  - CONFIRMED ì •ì‚° í›„ í™˜ë¶ˆ ë°œìƒ ì‹œ ìžë™ ì¡°ì • ë ˆì½”ë“œ ìƒì„±
  - íšŒê³„ ê°ì‚¬ ì¶”ì  ë° ìž¬ë¬´ ì •í™•ì„± ë³´ìž¥
- **ë°°ì¹˜ ë©±ë“±ì„±**: ì¤‘ë³µ ì •ì‚° ë°©ì§€ ë¡œì§

### 6. í†µí•© ê²€ìƒ‰ (Elasticsearch)
- **ì‹¤ì‹œê°„ ê²€ìƒ‰**: ì •ì‚°, ì£¼ë¬¸, ê²°ì œ, í™˜ë¶ˆ ë°ì´í„° í†µí•© ê²€ìƒ‰
- **í•œê¸€ í˜•íƒœì†Œ ë¶„ì„**: Nori Analyzer ì ìš©
- **ë³µí•© í•„í„°ë§**:
  - ë‚ ì§œ ë²”ìœ„ ê²€ìƒ‰
  - ê¸ˆì•¡ ë²”ìœ„ ê²€ìƒ‰
  - ìƒíƒœë³„ í•„í„°ë§
  - í™˜ë¶ˆ ì—¬ë¶€ í•„í„°ë§
- **ì§‘ê³„(Aggregation)**:
  - ì´ ê¸ˆì•¡, í‰ê· , ìµœì†Œ/ìµœëŒ€ ê¸ˆì•¡
  - ìƒíƒœë³„ ì¹´ìš´íŠ¸
  - í™˜ë¶ˆ ì¹´ìš´íŠ¸
  - ë‚ ì§œë³„ ì§‘ê³„
- **ì´ë²¤íŠ¸ ê¸°ë°˜ ë™ê¸°í™”**: PostgreSQL ë³€ê²½ ì‹œ Elasticsearch ì‹¤ì‹œê°„ ë°˜ì˜

### 7. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- **Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘**:
  - HTTP ìš”ì²­ ìˆ˜/ì‘ë‹µ ì‹œê°„
  - JVM ë©”ëª¨ë¦¬/GC ë©”íŠ¸ë¦­
  - ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€
  - ì»¤ìŠ¤í…€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­
- **Grafana ëŒ€ì‹œë³´ë“œ**:
  - ì‹¤ì‹œê°„ ì‹œê°í™”
  - ì•Œë¦¼ ì„¤ì • (ì—ëŸ¬ìœ¨, ì‘ë‹µì‹œê°„ ìž„ê³„ì¹˜)
  - Slack ì—°ë™ ê°€ëŠ¥

### 8. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- **Flyway í†µí•©**: ë²„ì „ ê¸°ë°˜ ìŠ¤í‚¤ë§ˆ ê´€ë¦¬
- **ìžë™ ë§ˆì´ê·¸ë ˆì´ì…˜**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œìž‘ ì‹œ ìžë™ ì‹¤í–‰
- **ë¡¤ë°± ì§€ì›**: ì•ˆì „í•œ ìŠ¤í‚¤ë§ˆ ë³€ê²½

### 9. API ë¬¸ì„œí™”
- **Swagger UI**: ì¸í„°ëž™í‹°ë¸Œ API ë¬¸ì„œ
- **OpenAPI 3.0 ê·œê²©**: í‘œì¤€í™”ëœ API ìŠ¤íŽ™
- **ìžë™ ìƒì„±**: SpringDoc OpenAPI ê¸°ë°˜

## ðŸ”’ ë³´ì•ˆ ê¸°ëŠ¥

### ë°ì´í„°ë² ì´ìŠ¤ ì œì•½ ì¡°ê±´
- `payments.refunded_amount` CHECK (0 ~ amount)
- `refunds(payment_id, idempotency_key)` UNIQUE ì¸ë±ìŠ¤
- `settlement_adjustments(refund_id)` UNIQUE ì¸ë±ìŠ¤
- `refunds.amount` CHECK (> 0)
- `settlement_adjustments.amount` CHECK (< 0)

### ë™ì‹œì„± ì œì–´
- **ë¹„ê´€ì  ë½ (PESSIMISTIC_WRITE)**: í™˜ë¶ˆ ì²˜ë¦¬ ì‹œ Payment row-level lock
- **ë©±ë“±ì„± í‚¤**: ì¤‘ë³µ ìš”ì²­ ë°©ì§€

### íŠ¸ëžœìž­ì…˜ ê´€ë¦¬
- **Spring @Transactional**: ì›ìžì„± ë³´ìž¥
- **ê²©ë¦¬ ìˆ˜ì¤€ ì œì–´**: ë°ì´í„° ì¼ê´€ì„± ìœ ì§€
